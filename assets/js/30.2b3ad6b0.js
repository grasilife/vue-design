(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{507:function(t,s,a){"use strict";a.r(s);var n=a(4),e=Object(n.a)({},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"插件开发指南"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#插件开发指南"}},[t._v("#")]),t._v(" 插件开发指南")]),t._v(" "),a("h2",{attrs:{id:"核心概念"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#核心概念"}},[t._v("#")]),t._v(" 核心概念")]),t._v(" "),a("p",[t._v("系统里有两个主要的部分：")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("@vue/cli")]),t._v("：全局安装的，暴露 "),a("code",[t._v("vue create <app>")]),t._v(" 命令；")]),t._v(" "),a("li",[a("code",[t._v("@vue/cli-service")]),t._v("：局部安装，暴露 "),a("code",[t._v("vue-cli-service")]),t._v(" 命令。")])]),t._v(" "),a("p",[t._v("两者皆应用了基于插件的架构。")]),t._v(" "),a("h3",{attrs:{id:"creator"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#creator"}},[t._v("#")]),t._v(" Creator")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/vuejs/vue-cli/tree/dev/packages/@vue/cli/lib/Creator.js",target:"_blank",rel:"noopener noreferrer"}},[t._v("Creator"),a("OutboundLink")],1),t._v(" 是调用 "),a("code",[t._v("vue create <app>")]),t._v(" 时创建的类。负责偏好对话、调用 generator 和安装依赖。")]),t._v(" "),a("h3",{attrs:{id:"service"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#service"}},[t._v("#")]),t._v(" Service")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/vuejs/vue-cli/tree/dev/packages/@vue/cli-service/lib/Service.js",target:"_blank",rel:"noopener noreferrer"}},[t._v("Service"),a("OutboundLink")],1),t._v(" 是调用 "),a("code",[t._v("vue-cli-service <command> [...args]")]),t._v(" 时创建的类。负责管理内部的 webpack 配置、暴露服务和构建项目的命令等。")]),t._v(" "),a("h3",{attrs:{id:"cli-插件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cli-插件"}},[t._v("#")]),t._v(" CLI 插件")]),t._v(" "),a("p",[t._v("CLI 插件是一个可以为 "),a("code",[t._v("@vue/cli")]),t._v(" 项目添加额外特性的 npm 包。它应该始终包含一个 "),a("a",{attrs:{href:"#service-%E6%8F%92%E4%BB%B6"}},[t._v("Service 插件")]),t._v("作为其主要导出，且可选的包含一个 "),a("a",{attrs:{href:"#generator"}},[t._v("Generator")]),t._v(" 和一个 "),a("a",{attrs:{href:"#%E7%AC%AC%E4%B8%89%E6%96%B9%E6%8F%92%E4%BB%B6%E7%9A%84%E5%AF%B9%E8%AF%9D"}},[t._v("Prompt 文件")]),t._v("。")]),t._v(" "),a("p",[t._v("一个典型的 CLI 插件的目录结构看起来是这样的：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v(".\n├── README.md\n├── generator.js  # generator (可选)\n├── prompts.js    # prompt 文件 (可选)\n├── index.js      # service 插件\n└── package.json\n")])])]),a("h3",{attrs:{id:"service-插件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#service-插件"}},[t._v("#")]),t._v(" Service 插件")]),t._v(" "),a("p",[t._v("Service 插件会在一个 Service 实例被创建时自动加载——比如每次 "),a("code",[t._v("vue-cli-service")]),t._v(" 命令在项目中被调用时。")]),t._v(" "),a("p",[t._v("注意我们这里讨论的“service 插件”的概念要比发布为一个 npm 包的“CLI 插件”的要更窄。前者涉及一个会被 "),a("code",[t._v("@vue/cli-service")]),t._v(" 在初始化时加载的模块，也经常是后者的一部分。")]),t._v(" "),a("p",[t._v("此外，"),a("code",[t._v("@vue/cli-service")]),t._v(" 的"),a("a",{attrs:{href:"https://github.com/vuejs/vue-cli/tree/dev/packages/@vue/cli-service/lib/commands",target:"_blank",rel:"noopener noreferrer"}},[t._v("内建命令"),a("OutboundLink")],1),t._v("和"),a("a",{attrs:{href:"https://github.com/vuejs/vue-cli/tree/dev/packages/@vue/cli-service/lib/config",target:"_blank",rel:"noopener noreferrer"}},[t._v("配置模块"),a("OutboundLink")],1),t._v("也是全部以 service 插件实现的。")]),t._v(" "),a("p",[t._v("一个 service 插件应该导出一个函数，这个函数接受两个参数：")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("一个 "),a("a",{attrs:{href:"https://github.com/vuejs/vue-cli/tree/dev/packages/@vue/cli-service/lib/PluginAPI.js",target:"_blank",rel:"noopener noreferrer"}},[t._v("PluginAPI"),a("OutboundLink")],1),t._v(" 实例")])]),t._v(" "),a("li",[a("p",[t._v("一个包含 "),a("code",[t._v("vue.config.js")]),t._v(" 内指定的项目本地选项的对象，或者在 "),a("code",[t._v("package.json")]),t._v(" 内的 "),a("code",[t._v("vue")]),t._v(" 字段。")])])]),t._v(" "),a("p",[t._v("这个 API 允许 service 插件针对不同的环境扩展/修改内部的 webpack 配置，并向 "),a("code",[t._v("vue-cli-service")]),t._v(" 注入额外的命令。例如：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("exports")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("api"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" projectOptions")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  api"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("chainWebpack")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("webpackConfig")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 通过 webpack-chain 修改 webpack 配置")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n  api"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("configureWebpack")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("webpackConfig")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 修改 webpack 配置")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 或返回通过 webpack-merge 合并的配置对象")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n  api"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("registerCommand")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'test'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("args")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 注册 `vue-cli-service test`")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h4",{attrs:{id:"为命令指定模式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#为命令指定模式"}},[t._v("#")]),t._v(" 为命令指定模式")]),t._v(" "),a("blockquote",[a("p",[t._v("注意：插件设置模式的方式从 beta.10 开始已经改变了。")])]),t._v(" "),a("p",[t._v("如果一个已注册的插件命令需要运行在特定的默认模式下，则该插件需要通过 "),a("code",[t._v("module.exports.defaultModes")]),t._v(" 以 "),a("code",[t._v("{ [commandName]: mode }")]),t._v(" 的形式来暴露：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("exports")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("api")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  api"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("registerCommand")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'build'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nmodule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("defaultModes "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  build"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'production'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("这是因为我们需要在加载环境变量之前知道该命令的预期模式，所以需要提前加载用户选项/应用插件。")]),t._v(" "),a("h4",{attrs:{id:"在插件中解析-webpack-配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#在插件中解析-webpack-配置"}},[t._v("#")]),t._v(" 在插件中解析 webpack 配置")]),t._v(" "),a("p",[t._v("一个插件可以通过调用 "),a("code",[t._v("api.resolveWebpackConfig()")]),t._v(" 取回解析好的 webpack 配置。每次调用都会新生成一个 webpack 配置用来在需要时进一步修改。")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("exports")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("api")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  api"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("registerCommand")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'my-build'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("args")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" configA "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" api"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolveWebpackConfig")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" configB "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" api"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolveWebpackConfig")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 针对不同的目的修改 `configA` 和 `configB`...")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 请确保为正确的环境变量指定默认模式")]),t._v("\nmodule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("defaultModes "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'my-build'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'production'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("或者，一个插件也可以通过调用 "),a("code",[t._v("api.resolveChainableWebpackConfig()")]),t._v(" 获得一个新生成的"),a("a",{attrs:{href:"https://github.com/mozilla-neutrino/webpack-chain",target:"_blank",rel:"noopener noreferrer"}},[t._v("链式配置"),a("OutboundLink")],1),t._v("：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("api"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("registerCommand")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'my-build'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("args")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" configA "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" api"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolveChainableWebpackConfig")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" configB "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" api"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolveChainableWebpackConfig")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 针对不同的目的链式修改 `configA` 和 `configB`...")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" finalConfigA "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" configA"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("toConfig")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" finalConfigB "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" configB"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("toConfig")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("h4",{attrs:{id:"第三方插件的自定义选项"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第三方插件的自定义选项"}},[t._v("#")]),t._v(" 第三方插件的自定义选项")]),t._v(" "),a("p",[a("code",[t._v("vue.config.js")]),t._v(" 的导出将会"),a("a",{attrs:{href:"https://github.com/vuejs/vue-cli/blob/dev/packages/%40vue/cli-service/lib/options.js#L3",target:"_blank",rel:"noopener noreferrer"}},[t._v("通过一个 schema 的验证"),a("OutboundLink")],1),t._v("以避免笔误和错误的配置值。然而，一个第三方插件仍然允许用户通过 "),a("code",[t._v("pluginOptions")]),t._v(" 字段配置其行为。例如，对于下面的 "),a("code",[t._v("vue.config.js")]),t._v("：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  pluginOptions"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    foo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* ... */")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("该第三方插件可以读取 "),a("code",[t._v("projectOptions.pluginOptions.foo")]),t._v(" 来做条件式的决定配置。")]),t._v(" "),a("h3",{attrs:{id:"generator"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#generator"}},[t._v("#")]),t._v(" Generator")]),t._v(" "),a("p",[t._v("一个发布为 npm 包的 CLI 插件可以包含一个 "),a("code",[t._v("generator.js")]),t._v(" 或 "),a("code",[t._v("generator/index.js")]),t._v(" 文件。插件内的 generator 将会在两种场景下被调用：")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("在一个项目的初始化创建过程中，如果 CLI 插件作为项目创建 preset 的一部分被安装。")])]),t._v(" "),a("li",[a("p",[t._v("插件在项目创建好之后通过 "),a("code",[t._v("vue invoke")]),t._v(" 独立调用时被安装。")])])]),t._v(" "),a("p",[t._v("这里的 "),a("a",{attrs:{href:"https://github.com/vuejs/vue-cli/tree/dev/packages/@vue/cli/lib/GeneratorAPI.js",target:"_blank",rel:"noopener noreferrer"}},[t._v("GeneratorAPI"),a("OutboundLink")],1),t._v(" 允许一个 generator 向 "),a("code",[t._v("package.json")]),t._v(" 注入额外的依赖或字段，并向项目中添加文件。")]),t._v(" "),a("p",[t._v("一个 generator 应该导出一个函数，这个函数接收三个参数：")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("一个 "),a("code",[t._v("GeneratorAPI")]),t._v(" 实例：")])]),t._v(" "),a("li",[a("p",[t._v("这个插件的 generator 选项。这些选项会在项目创建对话过程中被解析，或从一个保存在 "),a("code",[t._v("~/.vuerc")]),t._v(" 中的 preset 中加载。例如，如果保存好的 "),a("code",[t._v("~/.vuerc")]),t._v(" 像如下的这样：")]),t._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"presets"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"foo"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"plugins"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"@vue/cli-plugin-foo"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"option"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"bar"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("如果用户使用 preset "),a("code",[t._v("foo")]),t._v(" 创建了一个项目，那么 "),a("code",[t._v("@vue/cli-plugin-foo")]),t._v(" 的 generator 就会收到 "),a("code",[t._v("{ option: 'bar' }")]),t._v(" 作为第二个参数。")]),t._v(" "),a("p",[t._v("对于一个第三方插件来说，该选项将会解析自对话或用户执行 "),a("code",[t._v("vue invoke")]),t._v(" 时的命令行参数中 (详见"),a("a",{attrs:{href:"#%E7%AC%AC%E4%B8%89%E6%96%B9%E6%8F%92%E4%BB%B6%E7%9A%84%E5%AF%B9%E8%AF%9D"}},[t._v("第三方插件的对话")]),t._v(")。")])]),t._v(" "),a("li",[a("p",[t._v("整个 preset ("),a("code",[t._v("presets.foo")]),t._v(") 将会作为第三个参数传入。")])])]),t._v(" "),a("p",[a("strong",[t._v("示例：")])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("exports")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("api"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" options"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" rootOptions")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 修改 `package.json` 里的字段")]),t._v("\n  api"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("extendPackage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    scripts"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      test"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'vue-cli-service test'")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 复制并用 ejs 渲染 `./template` 内所有的文件")]),t._v("\n  api"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("render")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./template'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("options"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("foo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 有条件地生成文件")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h4",{attrs:{id:"generator-的模板处理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#generator-的模板处理"}},[t._v("#")]),t._v(" Generator 的模板处理")]),t._v(" "),a("p",[t._v("当你调用 "),a("code",[t._v("api.render('./template')")]),t._v(" 时，该 generator 将会使用 "),a("a",{attrs:{href:"https://github.com/mde/ejs",target:"_blank",rel:"noopener noreferrer"}},[t._v("EJS"),a("OutboundLink")],1),t._v(" 渲染 "),a("code",[t._v("./template")]),t._v(" 中的文件 (相对于 generator 中的文件路径进行解析)")]),t._v(" "),a("p",[t._v("此外，你可以使用 YAML 前置元信息继承并替换已有的模板文件的一部分：")]),t._v(" "),a("div",{staticClass:"language-ejs extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ejs"}},[a("code",[t._v("---\nextend: '@vue/cli-service/generator/template/src/App.vue'\nreplace: !!js/regexp /"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token script"}},[a("span",{pre:!0,attrs:{class:"token language-javascript"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("^")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("\\"),a("span",{pre:!0,attrs:{class:"token regex"}},[t._v("/script>/")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("script"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 替换默认脚本")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),a("p",[t._v("你也可以完成多处替换，当然你需要将要替换的字符串用 "),a("code",[t._v("<%# REPLACE %>")]),t._v(" 和 "),a("code",[t._v("<%# END_REPLACE %>")]),t._v(" 块包裹起来：")]),t._v(" "),a("div",{staticClass:"language-ejs extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ejs"}},[a("code",[t._v("---\nextend: '@vue/cli-service/generator/template/src/App.vue'\nreplace:\n  - !!js/regexp /欢迎来到你的 Vue\\.js 应用/\n  - !!js/regexp /"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token script"}},[a("span",{pre:!0,attrs:{class:"token language-javascript"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("^")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("\\"),a("span",{pre:!0,attrs:{class:"token regex"}},[t._v("/script>/")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token ejs language-ejs"}},[a("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[t._v("<%")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# REPLACE ")]),a("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[t._v("%>")])]),t._v("\n替换欢迎信息\n"),a("span",{pre:!0,attrs:{class:"token ejs language-ejs"}},[a("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[t._v("<%")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# END_REPLACE ")]),a("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[t._v("%>")])]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token ejs language-ejs"}},[a("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[t._v("<%")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# REPLACE ")]),a("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[t._v("%>")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("script"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 替换默认脚本")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token ejs language-ejs"}},[a("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[t._v("<%")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# END_REPLACE ")]),a("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[t._v("%>")])]),t._v("\n")])])]),a("h4",{attrs:{id:"文件名的极端情况"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#文件名的极端情况"}},[t._v("#")]),t._v(" 文件名的极端情况")]),t._v(" "),a("p",[t._v("如果你想要渲染一个以点开头的模板文件 (例如 "),a("code",[t._v(".env")]),t._v(")，则需要遵循一个特殊的命名约定，因为以点开头的文件会在插件发布到 npm 的时候被忽略：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("# 以点开头的模板需要使用下划线取代那个点：\n\n/generator/template/_env\n\n# 调用 api.render('./template') 会在项目目录中渲染成为：\n\n.env\n")])])]),a("p",[t._v("同时这也意味着当你想渲染以下划线开头的文件时，同样需要遵循一个特殊的命名约定：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("# 这种模板需要使用两个下划线来取代单个下划线：\n\n/generator/template/__variables.scss\n\n# 调用 api.render('./template') 会在项目目录中渲染成为：\n\n_variables.scss\n")])])]),a("h3",{attrs:{id:"prompts"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#prompts"}},[t._v("#")]),t._v(" Prompts")]),t._v(" "),a("h4",{attrs:{id:"内建插件的对话"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#内建插件的对话"}},[t._v("#")]),t._v(" 内建插件的对话")]),t._v(" "),a("p",[t._v("只有内建插件可以定制创建新项目时的初始化对话，且这些对话模块放置在 "),a("a",{attrs:{href:"https://github.com/vuejs/vue-cli/tree/dev/packages/@vue/cli/lib/promptModules",target:"_blank",rel:"noopener noreferrer"}},[a("code",[t._v("@vue/cli")]),t._v(" 包的内部"),a("OutboundLink")],1),t._v("。")]),t._v(" "),a("p",[t._v("一个对话模块应该导出一个函数，这个函数接收一个 "),a("a",{attrs:{href:"https://github.com/vuejs/vue-cli/tree/dev/packages/@vue/cli/lib/PromptModuleAPI.js",target:"_blank",rel:"noopener noreferrer"}},[t._v("PromptModuleAPI"),a("OutboundLink")],1),t._v(" 实例。这些对话的底层使用 "),a("a",{attrs:{href:"https://github.com/SBoudrias/Inquirer.js",target:"_blank",rel:"noopener noreferrer"}},[t._v("inquirer"),a("OutboundLink")],1),t._v(" 进行展示：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("exports")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("api")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 一个特性对象应该是一个有效的 inquirer 选择对象")]),t._v("\n  api"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("injectFeature")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Some great feature'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'my-feature'")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// injectPrompt 期望接收一个有效的 inquirer 对话对象")]),t._v("\n  api"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("injectPrompt")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'someFlag'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 确认对话只在用户已经选取了特性的时候展示")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("when")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("answers")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" answers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("features"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("include")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'my-feature'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    message"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Do you want to turn on flag foo?'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    type"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'confirm'")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 当所有的对话都完成之后，将你的插件注入到")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 即将传递给 Generator 的 options 中")]),t._v("\n  api"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("onPromptComplete")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("answers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" options")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("answers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("features"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("includes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'my-feature'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      options"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("plugins"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'vue-cli-plugin-my-feature'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        someFlag"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" answers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("someFlag\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h4",{attrs:{id:"第三方插件的对话"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第三方插件的对话"}},[t._v("#")]),t._v(" 第三方插件的对话")]),t._v(" "),a("p",[t._v("第三方插件通常会在一个项目创建完毕后被手动安装，且用户将会通过调用 "),a("code",[t._v("vue invoke")]),t._v(" 来初始化这个插件。如果这个插件在其根目录包含一个 "),a("code",[t._v("prompts.js")]),t._v("，那么它将会用在该插件被初始化调用的时候。这个文件应该导出一个用于 Inquirer.js 的"),a("a",{attrs:{href:"https://github.com/SBoudrias/Inquirer.js#question",target:"_blank",rel:"noopener noreferrer"}},[t._v("问题"),a("OutboundLink")],1),t._v("的数组。这些被解析的答案对象会作为选项被传递给插件的 generator。")]),t._v(" "),a("p",[t._v("或者，用户可以通过在命令行传递选项来跳过对话直接初始化插件，比如：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("vue invoke my-plugin --mode awesome\n")])])]),a("h2",{attrs:{id:"发布插件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#发布插件"}},[t._v("#")]),t._v(" 发布插件")]),t._v(" "),a("p",[t._v("为了让一个 CLI 插件能够被其它开发者使用，你必须遵循 "),a("code",[t._v("vue-cli-plugin-<name>")]),t._v(" 的命名约定将其发布到 npm 上。插件遵循命名约定之后就可以：")]),t._v(" "),a("ul",[a("li",[t._v("被 "),a("code",[t._v("@vue/cli-service")]),t._v(" 发现；")]),t._v(" "),a("li",[t._v("被其它开发者搜索到；")]),t._v(" "),a("li",[t._v("通过 "),a("code",[t._v("vue add <name>")]),t._v(" 或 "),a("code",[t._v("vue invoke <name>")]),t._v(" 安装下来。")])]),t._v(" "),a("h2",{attrs:{id:"开发核心插件的注意事项"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#开发核心插件的注意事项"}},[t._v("#")]),t._v(" 开发核心插件的注意事项")]),t._v(" "),a("div",{staticClass:"tip custom-block"},[a("p",{staticClass:"custom-block-title"},[t._v("注意")]),t._v(" "),a("p",[t._v("这个章节只用于 "),a("code",[t._v("vuejs/vue-cli")]),t._v(" 仓库内部的内建插件工作。")])]),t._v(" "),a("p",[t._v("一个带有为本仓库注入额外依赖的 generator 的插件 (比如 "),a("code",[t._v("chai")]),t._v(" 会通过 "),a("code",[t._v("@vue/cli-plugin-unit-mocha/generator/index.js")]),t._v(" 被注入) 应该将这些依赖列入其自身的 "),a("code",[t._v("devDependencies")]),t._v(" 字段。这会确保：")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("这个包始终存在于该仓库的根 "),a("code",[t._v("node_modules")]),t._v(" 中，因此我们不必在每次测试的时候重新安装它们。")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("yarn.lock")]),t._v(" 会保持其一致性，因此 CI 程序可以更好地利用缓存。")])])])])},[],!1,null,null,null);s.default=e.exports}}]);